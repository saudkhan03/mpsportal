var expensemodule=angular.module("app-mps",[]);expensemodule.controller("expense-edit",["$scope","$http",function(s,n){var t=[];s.wait=!0,n.get("/Expense/LoadEditExpenses").then(function(e){t=e.data.expenses,s.ExpenseList=t,s.wait=!1},function(e){alert(e.statusText),s.wait=!1}),s.changed=function(){s.ExpenseList=s.searchtext?performfilter(s.searchtext):t},performfilter=function(e){return filterby=e.toLocaleLowerCase(),t.filter(function(e){return-1!=e.expenseName.toLocaleLowerCase().indexOf(filterby)})},s.getExpense=function(e){s.wait=!0,n.get("/Expense/getExpense",{params:{id:e}}).then(function(e){s.expense=e.data,e.data.attachment1?($("#attachment").show(),$("#attachmentnew").hide(),$("#oldattachment").hide(),i($("#fileicon1"),e.data.attachment1.fileExtension)):($("#attachment").hide(),$("#attachmentnew").show(),$("#oldattachment").hide());var t=(n=new Date(s.expense.expenseDate)).getDate(),a=n.getMonth()+1;t<10&&(t="0"+t),a<10&&(a="0"+a);var n=t+"-"+a+"-"+n.getFullYear();s.expense.expenseDate=n,s.wait=!1},function(e){s.wait=!1,alert(e.statusText)}),s.getStudents()},s.getStudents=function(){s.wait=!0,n.get("/Expense/LoadStudentListForExpense").then(function(e){var a=[];a.push({studentSlabId:0,studentName:"No linked student"}),$.each(e.data.students,function(e,t){a.push(t)}),s.studentList=a,s.wait=!1},function(e){alert("Could not load student list\n"+e.statusText),s.wait=!1})},s.editExpense=function(){s.wait=!0;var e=new Date(Number($("#expenseDate").val().split("-")[2]),Number($("#expenseDate").val().split("-")[1])-1,Number($("#expenseDate").val().split("-")[0])+1,0,0,0).toUTCString();if(s.expense.expenseDate=e,s.expense.expenseId=s.expense.id,0<$("#expenseAttachment1").val().length){var t=document.getElementById("expenseAttachment1").files[0],a=new FileReader;a.addEventListener("load",function(){s.expense.expenseAttachment1=t.name+"~"+a.result,n.post("/Expense/UpdateExpense",s.expense).then(function(e){s.wait=!1,e.data.res?(alert("updated expense"),window.location.reload(!0)):alert(e.data.status+"\n - "+e.data.errors)},function(e){s.wait=!1,alert(e.statusText)})},!1),t&&a.readAsDataURL(t)}else n.post("/Expense/UpdateExpense",s.expense).then(function(e){s.wait=!1,e.data.res?(alert("updated expense"),window.location.reload(!0)):alert(e.data.status+"\n - "+e.data.errors)},function(e){s.wait=!1,alert(e.statusText)})},s.download1=function(){s.wait=!0,n.post("/Expense/downloadAttachment",s.expense.attachment1).then(function(e){s.wait=!1,window.location.href=e.data.url},function(e){s.wait=!1,alert(e.statusText)})};var i=function(e,t){switch(t){case"pdf":e.html(""),e.html('<i class="fa fa-file-pdf-o"></i>');break;case"jpg":case"jpeg":case"JPG":case"JPEG":case"bmp":case"BMP":case"tiff":case"png":case"PNG":e.html(""),e.html('<i class="fa fa-file-image-o"></i>');break;case"docx":case"doc":e.html(""),e.html('<i class="fa fa-file-word-o"></i>');break;case"xsl":case"xlsx":e.html(""),e.html('<i class="fa fa-file-excel-o"></i>');break;case"txt":case"log":e.html(""),e.html('<i class="fa fa-file-text-o"></i>');break;case"zip":case"rar":e.html(""),e.html('<i class="fa fa-file-archive-o"></i>');break;default:e.html(""),e.html('<i class="fa fa-file"></i>')}}}]);