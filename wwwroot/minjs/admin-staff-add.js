var adminmodule=angular.module("app-mps",[]);adminmodule.controller("staff-add",["$scope","$http",function(o,a){o.wait=!0,o.loaderMsg="Loading...",a.get("/Admin/LoadAddStaff").then(function(a){var n=[];$.each(a.data.deductions,function(a,t){var e={index:a,name:t.name,value:t.value,type:t.type,display:t.value+("A"==t.type?" Rs.":t.type)};n.push(e)});var t={gender:"Male",joiningDate:"",dob:"",password:"P@ssw0rd",deductions:n,salary:0,staffRole:"Staff"};o.roles=[{id:"Staff",name:"Staff"},{id:"Teacher",name:"Teacher"},{id:"Admin",name:"Administrator"},{id:"Accountant",name:"Accountant"},{id:"PrimeStaff",name:"PrimeStaff"}],o.staff=t,o.isTeacherChange(),o.wait=!1},function(a){alert(a.statusText),o.wait=!1}),o.isTeacherChange=function(){o.staff.isTeacher?($("#isTeacher").attr("style","background-color:green;outline:5px solid green"),$("#lblisTeacher").text("IS TEACHER"),o.staff.staffRole="Teacher"):($("#isTeacher").attr("style","background-color:yellow;outline:5px solid yellow"),$("#lblisTeacher").text("NOT TEACHER"),o.staff.staffRole="Staff")},o.salaryChange=function(){var a=o.staff.deductions,n=o.txtSalary,i=[];$.each($('[id^="chkd_"]'),function(a,t){$(this).is(":checked")&&i.push(t.id.split("_")[1])});var s=0,r=[];$.each(a,function(a,t){var e=t.value;if(-1<$.inArray(t.index.toString(),i))switch(t.type){case"%":3e4<n&&-1<t.name.indexOf("Provident fund")&&(0<s?(t.display="  "+s+" - ("+e+t.type+" of "+n+") = "+(s-Number(e)%s).toString(),s=(s-Number(e)%s).toString()):(t.display="  "+n+" - ("+e+t.type+" of "+n+") = "+(n-Number(e)%n).toString(),s=(n-Number(e)%n).toString()),r.push(t)),n<3e4&&-1<t.name.indexOf("Provident fund")?t.display=t.value+("A"==t.type?" Rs.":t.type):-1==t.name.indexOf("Provident fund")&&(0<s?(t.display="  "+s+" - ("+e+t.type+" of "+n+") = "+(s-Number(e)%s).toString(),s=(s-Number(e)%s).toString()):(t.display="  "+n+" - ("+e+t.type+" of "+n+") = "+(n-Number(e)%n).toString(),s=(n-Number(e)%n).toString())),r.push(t);break;case"A":case"Rs":0<s?(t.display=" "+s+" - Rs. "+e+" = "+(s-Number(e)).toString(),s=(s-Number(e)).toString()):(t.display=" "+n+" - Rs. "+e+" = "+(n-Number(e)).toString(),s=(n-Number(e)).toString()),r.push(t)}else t.display=t.value+t.type,r.push(t)}),o.staff.deductions=r,o.staff.salary=s},o.addStaff=function(){o.wait=!0,o.loaderMsg="Creating new staff, please wait...";var a=new Date(Number($("#joiningDate").val().split("-")[2]),Number($("#joiningDate").val().split("-")[1])-1,Number($("#joiningDate").val().split("-")[0])+1,0,0,0).toUTCString();o.staff.joiningDate=a;var t=new Date(Number($("#dob").val().split("-")[2]),Number($("#dob").val().split("-")[1])-1,Number($("#dob").val().split("-")[0])+1,0,0,0).toUTCString();o.staff.dob=t;var e=[],n=[];$.each($('[id^="chkd_"]'),function(a,t){$(this).is(":checked")&&n.push(t.id.split("_")[1])}),$.each(o.staff.deductions,function(a,t){-1<$.inArray(t.index.toString(),n)&&e.push(t)}),o.staff.deductions=e,i(s)};var i=function(a){var t=document.getElementById("filePic").files[0],e=document.getElementById("aadhaarCard").files[0];r1=new FileReader,r2=new FileReader,t&&(r1.addEventListener("load",function(){o.staff.staffPic=t.name+"~"+r1.result},!1),r1.readAsDataURL(t)),e&&(r2.addEventListener("load",function(){o.staff.aadhaarCard=e.name+"~"+r2.result},!1),r2.readAsDataURL(e)),setTimeout(function(){a()},1e3)},s=function(){a.post("/Admin/Staff",o.staff).then(function(a){a.data.res?(o.wait=!1,alert(a.data.status),window.location.href="/Home/Index"):(o.wait=!1,alert(a.data.status+"\n"+a.data.errors.split("-").join("\n")),$("#joiningDate").val(""),$("#dob").val(""))},function(a){alert(a.statusText),$("#joiningDate").val(""),$("#dob").val("")})};o.makeUserName=function(){try{var a=2<o.staff.firstName.length?o.staff.firstName.substr(0,4):o.staff.firstName.toLocaleLowerCase(),t=2<o.staff.lastName.length?o.staff.lastName.substr(0,4):o.staff.lastName.toLocaleLowerCase()}catch(a){}a&&t&&(o.staff.userName=a+"_"+t)}}]);