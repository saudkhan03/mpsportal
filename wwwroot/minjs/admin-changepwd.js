var adminmodule=angular.module("app-mps",[]);adminmodule.controller("admin-changepwd",["$scope","$http",function(s,e){var r=[];s.wait=!0,e.get("/Admin/LoadStudentsPwd").then(function(t){r=t.data.students,s.StudentList=r,s.wait=!1},function(t){alert(t.statusText),s.wait=!1});var a=[];s.wait=!0,e.get("/Admin/LoadStaffPwd").then(function(t){a=t.data.staffList,s.StaffList=a,s.wait=!1},function(t){alert(t.statusText),s.wait=!1}),s.changedStudent=function(){s.StudentList=s.searchTextStudent?performfilterstudent(s.searchTextStudent):r},s.changedStaff=function(){s.StaffList=s.searchTextStaff?performfilterstaff(s.searchTextStaff):a},performfilterstudent=function(t){return filterby=t.toLocaleLowerCase(),r.filter(function(t){return-1!=t.studentName.toLocaleLowerCase().indexOf(filterby)})},performfilterstaff=function(t){return filterby=t.toLocaleLowerCase(),a.filter(function(t){return-1!=t.staffName.toLocaleLowerCase().indexOf(filterby)})},s.getUser=function(t,e){var r={id:t,name:e.split("-")[1],userName:e.split("-")[3],oldPassword:""};s.user=r},s.oldPwdChange=function(){$("#btnVerify").hasClass("btn-success")&&($("#btnVerify").addClass("btn-info"),$("#btnVerify").removeClass("btn-success"),$("#btnVerify").html("Verify")),3<s.user.oldPassword.length?$("#btnVerify").prop("disabled",!1):$("#btnVerify").prop("disabled",!0)},s.verify=function(){s.wait=!0;var t={userName:s.user.userName,oldPassword:s.user.oldPassword};e.post("/Admin/verifyUserPassword",t).then(function(t){t.data?($(".js-newpwd").show(),$("#btnVerify").removeClass("btn-info"),$("#btnVerify").addClass("btn-success"),$("#btnVerify").html('<i class="fa fa-check"><i> Verified'),$("#btnVerify").prop("disabled",!0),$("#oldPassword").attr("readonly",!0)):($(".js-newpwd").hide(),alert("Wrong password!\nPlease retry"),s.user.oldPassword="",$("#btnVerify").prop("disabled",!0),$("#btnVerify").addClass("btn-info"),$("#btnVerify").removeClass("btn-success"),$("#btnVerify").html("Verify")),s.wait=!1},function(t){alert(t.statusText),s.wait=!1})},s.passwordChange=function(){s.confirmPassword==s.newPassword?($("#newPassword").attr("style","border:1px solid green"),$("#confirmPassword").attr("style","border:1px solid green")):($("#newPassword").attr("style","border:1px solid red"),$("#confirmPassword").attr("style","border:1px solid red"),s.frmChangePwd.$invalid=!0)},s.changePassword=function(){s.wait=!0;var t={userName:s.user.userName,oldPassword:s.user.oldPassword,newPassword:s.newPassword};e.post("/Admin/changePassword",t).then(function(t){s.wait=!1,t.data.res?alert(t.data.status):alert(t.data.status+"\n"+t.data.errors),window.location.reload(!0)},function(t){alert(t.statusText),s.wait=!1})},s.getActiveClass=function(t){return"True"==t?"fa fa-circle-o activeUser":"fa fa-circle-o inactiveUser"}}]);