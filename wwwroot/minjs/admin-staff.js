var adminmodule=angular.module("app-mps",[]);adminmodule.controller("staff-edit",["$scope","$http",function(i,a){var e=[];i.wait=!0,i.loaderMsg="Loading...",a.get("/Admin/LoadEditStaff").then(function(t){e=t.data.staffList,i.StaffList=e,i.roles=[{id:"Staff",name:"Staff"},{id:"Teacher",name:"Teacher"},{id:"Admin",name:"Administrator"},{id:"Accountant",name:"Accountant"},{id:"PrimeStaff",name:"PrimeStaff"}],i.wait=!1},function(t){alert(t.statusText),i.wait=!1}),i.changed=function(){i.StaffList=i.searchtext?performfilter(i.searchtext):e},performfilter=function(t){return filterby=t.toLocaleLowerCase(),e.filter(function(t){return-1!=t.staffName.toLocaleLowerCase().indexOf(filterby)})},i.getStaff=function(t){i.wait=!0,$("#picImg").attr("src","/images/personPlaceholder.jpg"),$("#picImg").attr("style","border: 1px solid #CCC;"),i.loaderMsg="Getting staff...",a.get("/Admin/getStaff",{params:{id:t}}).then(function(t){i.staff=t.data,t.data.isActive?$("#isActive").attr("style","background-color:green;outline:5px solid green"):$("#isActive").attr("style","background-color:yellow;outline:5px solid yellow"),t.data.staffPic&&($("#picImg").attr("style","width: 150px; max-height: 150px;"),document.querySelector("#picImg").setAttribute("src",t.data.staffPic.split("~")[1])),t.data.aadhaarCard&&document.querySelector("#aadhaarPic").setAttribute("src",t.data.aadhaarCard.split("~")[1]),i.wait=!1},function(t){i.wait=!1,alert(t.statusText)})},i.updateStaff=function(){i.wait=!0,i.loaderMsg="Updating staff details, please wait...";var t=new Date(Number($("#joiningDate").val().split("-")[2]),Number($("#joiningDate").val().split("-")[1])-1,Number($("#joiningDate").val().split("-")[0])+1,0,0,0).toUTCString();i.staff.joiningDate=t;var a=new Date(Number($("#dob").val().split("-")[2]),Number($("#dob").val().split("-")[1])-1,Number($("#dob").val().split("-")[0])+1,0,0,0).toUTCString();i.staff.dob=a,i.staff.password="na",i.staff.salary=1e3,r(n)};var r=function(t){var a=document.getElementById("filePic").files[0],e=document.getElementById("aadhaarCard").files[0];r1=new FileReader,r2=new FileReader,a&&(r1.addEventListener("load",function(){i.staff.staffPic=a.name+"~"+r1.result},!1),r1.readAsDataURL(a)),e&&(r2.addEventListener("load",function(){i.staff.aadhaarCard=e.name+"~"+r2.result},!1),r2.readAsDataURL(e)),setTimeout(function(){t()},1e3)},n=function(){a.post("/Admin/UpdateStaff",i.staff).then(function(t){i.wait=!1,t.data.res?(alert(t.data.status),window.location.reload(!0)):(alert(t.data.status+t.data.err),$("#joiningDate").val(""),$("#dob").val(""))},function(t){i.wait=!1,alert(t.statusText),$("#joiningDate").val(""),$("#dob").val("")})};i.getActiveClass=function(t){return"True"==t?"fa fa-circle-o activeUser":"fa fa-circle-o inactiveUser"}}]);