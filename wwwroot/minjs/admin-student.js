var adminmodule=angular.module("app-mps",[]);adminmodule.controller("student-edit",["$scope","$http",function(i,e){var n=[];i.wait=!0,i.loaderMsg="Loading...",e.get("/Admin/LoadEditStudent").then(function(t){var e=r(t.data.students);n=e,i.StudentList=n,i.grades=t.data.grades,i.totalfees=t.data.totalfees,i.slabs=t.data.slabs,i.wait=!1},function(t){alert(t.statusText),i.wait=!1}),i.changed=function(){i.StudentList=i.searchtext?performfilter(i.searchtext):n};var r=function(t){var a=[],n="",r=1;return $.each(t,function(t,e){n!=e.studentId?(n=e.studentId,a.push(e)):(d(a[t-r].studentName.split("-")[3],e.studentName.split("-")[3])||(a.splice(t-r,1),a.push(e)),r++)}),a},d=function(t,e){return t="LKG"==t?-1:"UKG"==t?0:t.split(" ")[0],"LKG"==e?e=-1:"UKG"==e&&(e=0),Number(t)>Number(e)};i.getStudent=function(t){i.wait=!0,$("#picImg").attr("src","/images/personPlaceholder.jpg"),$("#picImg").attr("style","border: 1px solid #CCC;"),i.loaderMsg="Getting student...",i.student=e.get("/Admin/getStudent",{params:{id:t}}).then(function(t){i.student=t.data,t.data.isActive?$("#isActive").attr("style","background-color:green;outline:5px solid green"):$("#isActive").attr("style","background-color:yellow;outline:5px solid yellow"),t.data.studentPic&&($("#picImg").attr("style","width: 150px; max-height: 150px;"),document.querySelector("#picImg").setAttribute("src",t.data.studentPic.split("~")[1])),t.data.aadhaarCard&&document.querySelector("#aadhaarPic").setAttribute("src",t.data.aadhaarCard.split("~")[1]),t.data.fatherAadhaarCard&&document.querySelector("#fatherAadhaarPic").setAttribute("src",t.data.fatherAadhaarCard.split("~")[1]),t.data.motherAadhaarCard&&document.querySelector("#motherAadhaarPic").setAttribute("src",t.data.motherAadhaarCard.split("~")[1]),t.data.transferCert&&document.querySelector("#transferCertPic").setAttribute("src",t.data.transferCert.split("~")[1]),i.wait=!1},function(t){i.wait=!1,alert(t.statusText)})},performfilter=function(t){return filterby=t.toLocaleLowerCase(),n.filter(function(t){return-1!=t.studentName.split("-").splice(1,3).join("").toLocaleLowerCase().indexOf(filterby)})},i.getFees=function(){e.get("/Admin/getFee",{params:{slabName:i.student.slabName,grade:i.student.grade}}).then(function(t){0!=t.data&&$("#txtFee").val(t.data)},function(t){alert(t.statusText)})},i.updateStudent=function(){i.wait=!0,i.loaderMsg="Updating student details, please wait...",i.student.totalFee=$("#txtFee").val();var t=new Date(Number($("#admissionDate").val().split("-")[2]),Number($("#admissionDate").val().split("-")[1])-1,Number($("#admissionDate").val().split("-")[0])+1,0,0,0).toUTCString();i.student.admissionDate=t;var e=new Date(Number($("#dob").val().split("-")[2]),Number($("#dob").val().split("-")[1])-1,Number($("#dob").val().split("-")[0])+1,0,0,0).toUTCString();i.student.dob=e,i.student.password="na",a(s)};var a=function(t){var e=document.getElementById("filePic").files[0],a=document.getElementById("aadhaarCard").files[0],n=document.getElementById("fatherAadhaarCard").files[0],r=document.getElementById("motherAadhaarCard").files[0],d=document.getElementById("transferCert").files[0];r1=new FileReader,r2=new FileReader,r3=new FileReader,r4=new FileReader,r5=new FileReader,e&&(r1.addEventListener("load",function(){i.student.studentPic=e.name+"~"+r1.result},!1),r1.readAsDataURL(e)),a&&(r2.addEventListener("load",function(){i.student.aadhaarCard=a.name+"~"+r2.result},!1),r2.readAsDataURL(a)),n&&(r3.addEventListener("load",function(){i.student.fatherAadhaarCard=n.name+"~"+r3.result},!1),r3.readAsDataURL(n)),r&&(r4.addEventListener("load",function(){i.student.motherAadhaarCard=r.name+"~"+r4.result},!1),r4.readAsDataURL(r)),d&&(r5.addEventListener("load",function(){i.student.transferCert=d.name+"~"+r5.result},!1),r5.readAsDataURL(d)),setTimeout(function(){t()},1e3)},s=function(){e.post("/Admin/UpdateStudent",i.student).then(function(t){t.data.res?(i.wait=!1,alert(t.data.status),window.location.reload(!0)):(i.wait=!1,alert(t.data.status))},function(t){i.wait=!1,alert(t.statusText),$("#admissionDate").val(""),$("#dob").val("")})};i.getActiveClass=function(t){return"True"==t?"fa fa-circle-o activeUser":"fa fa-circle-o inactiveUser"},i.changeListActive=function(){var a=!1;$.each(i.StudentFullList,function(t,e){-1<e.studentName.indexOf("False")&&(a=!0)}),i.wait=!0,a?(n=[],$("#chkActive").is(":checked")?($.each(i.StudentList,function(t,e){-1==e.studentName.indexOf("False")&&n.push(e)}),i.StudentList=n):(i.StudentList=i.StudentFullList,n=i.StudentFullList),i.wait=!1):e.get("/Admin/getStudentList?activeOnly="+$("#chkActive").is(":checked")).then(function(t){n=[];var e=r(t.data);i.StudentFullList=e,i.StudentList=i.StudentFullList,n=i.StudentFullList,i.wait=!1},function(t){alert(t.statusText),i.wait=!1})}}]);