function validateEmail(e){var t=e.split(";"),i=!0;if(1<t.length)$.each(t,function(e,t){var a=t.indexOf("@"),n=t.lastIndexOf(".");if(a<1||n<a+2||n+2>=t.length)return i=!1});else if(0<t[0].length){var a=t[0].indexOf("@"),n=t[0].lastIndexOf(".");(a<1||n<a+2||n+2>=t[0].length)&&(i=!1)}return i}function validateSend(){0<$("#txtTo").val().length&&(2<$("#txtCC").val().length&&$("#txtCC").attr("style").indexOf("border:1px solid red")<0||0==$("#txtCC").val().length)&&0<$("#txtSubject").val().length&&0<$("#txtBody").val().length&&$("#btnSend").attr("disabled",!1)}$(document).ready(function(){var e="/Admin/LoadStudentsMail";$("#gridStudents").jqGrid({url:e,datatype:"json",colNames:["StudentId","Active","Name","Roll No.","Class"],colModel:[{name:"studentId",index:"studentId",hidden:!0,align:"center"},{name:"isActive",index:"isActive",width:40,align:"center",formatter:"checkbox",edittype:"checkbox",editoptions:{value:"true:false",defaultValue:"true"}},{name:"studentName",index:"studentName",width:120,align:"center"},{name:"rollNumber",index:"rollNumber",width:70,align:"center"},{name:"grade",index:"grade",width:120,align:"center"}],cmTemplate:{resizable:!1},loadonce:!0,rowNum:5e3,sortname:"Name",viewrecords:!0,sortorder:"asc",multiselect:!0,cmTemplate:{resizable:!0},loadComplete:function(e){}});var t=$("#gridStudents")[0].grid.cDiv;$("#gridStudents").setCaption(""),$("a.ui-jqgrid-titlebar-close",t).unbind(),$(t).hide(),$("#gridStudents").jqGrid("filterToolbar",{stringResult:!0,searchOnEnter:!1,defaultSearch:"cn"});e="/Admin/LoadStaffMail";$("#gridStaff").jqGrid({url:e,datatype:"json",colNames:["StaffId","Active","Name","Joined on","T/S"],colModel:[{name:"staffId",index:"staffId",hidden:!0,align:"center"},{name:"isActive",index:"isActive",width:40,align:"center",formatter:"checkbox",edittype:"checkbox",editoptions:{value:"true:false",defaultValue:"true"}},{name:"staffName",index:"staffName",width:120,align:"center"},{name:"joiningDate",index:"joiningDate",width:100,align:"center",sorttype:"date",formatter:"date",formatoptions:{newformat:"d-M-Y"},datefmt:"d-M-Y"},{name:"isTeacher",index:"isTeacher",width:70,align:"center"}],cmTemplate:{resizable:!1},loadonce:!0,rowNum:5e3,sortname:"Name",viewrecords:!0,sortorder:"asc",multiselect:!0,cmTemplate:{resizable:!0},loadComplete:function(e){}});t=$("#gridStaff")[0].grid.cDiv;$("#gridStaff").setCaption(""),$("a.ui-jqgrid-titlebar-close",t).unbind(),$(t).hide(),$("#gridStaff").jqGrid("filterToolbar",{stringResult:!0,searchOnEnter:!1,defaultSearch:"cn"}),$(".js-addMails").click(function(){var e="",t=[];e=$("#students").hasClass("active")?"#gridStudents":"#gridStaff",$(e+" input:checked").each(function(){$(this).attr("disabled")||t.push($(this).closest("tr > td").next().html())});var a="";$.each(t,function(e,t){a+=t+";"}),$("#txtTo").val(a.substr(0,a.length-1)),validateSend()}),$("#btnSend").click(function(){var e=$("#txtTo").val(),t=$("#txtCC").val(),a=$("#txtSubject").val(),n=$("#txtBody").val();$(".loader").show(),$.post("/Admin/SendMails",{to:e,cc:t,subject:a,body:n},function(e){$(".loader").hide(),e&&(alert("Email sent."),window.location.href="/Home/Index")})}),$("#txtCC").keyup(function(){validateEmail($("#txtCC").val())?($(this).attr("style","border:1px solid #ccc"),2<$("#txtTo").val().length&&$("#btnSend").attr("disabled",!1)):($(this).attr("style","border:1px solid red"),$("#btnSend").attr("disabled",!0)),validateSend()}),$("#txtSubject").keyup(function(){validateSend()}),$("#txtBody").keyup(function(){validateSend()})});