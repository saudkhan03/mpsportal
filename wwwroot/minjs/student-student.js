var adminmodule=angular.module("app-mps",[]);adminmodule.controller("student-student",["$scope","$http",function(x,r){var n=[];x.wait=!0,r.get("/Students/getStudentList?activeOnly="+!0).then(function(t){n=t.data,x.StudentFullList=n,x.StudentList=x.StudentFullList,x.Type="0",x.wait=!1},function(t){alert(t.statusText),x.wait=!1}),x.changed=function(){x.StudentList=x.searchtext?performfilter(x.searchtext):n},performfilter=function(t){return filterby=t.toLocaleLowerCase(),n.filter(function(t){return-1!=t.studentName.split("-").splice(1,3).join("").toLocaleLowerCase().indexOf(filterby)})},x.getStudent=function(n,t){$("#hidGrade").val(t),x.wait=!0,x.selectedStudentId=n,x.selectedStudentGrade=t,x.student=r.get("/Students/getStudentMatrix",{params:{id:n,grade:t}}).then(function(t){x.studentMatrix=t.data,x.studentMatrix[0].studentId=n;var e=[],a=[],r=0;for(r=0;r<x.studentMatrix.length;r++){var i=x.studentMatrix[r];"Attendance"==i.type&&(a.push(i.exam1),a.push(i.exam2),a.push(i.exam3),a.push(i.exam4),a.push(i.exam5),a.push(i.exam6)),"Text"==i.type&&"Remarks"==i.subject&&(e.push(i.exam1),e.push(i.exam2),e.push(i.exam3),e.push(i.exam4),e.push(i.exam5),e.push(i.exam6))}x.attendanceArray=a,x.remarksArray=e,x.getTotals(),x.wait=!1},function(t){x.wait=!1,alert(t.statusText)}),generateCharacterCert(n,t)},generateCharacterCert=function(t,e){x.student=r.get("/Students/getStudentCharacterCert",{params:{id:t,grade:e}}).then(function(t){var a=[],r=[];$.each(t.data,function(t,e){e.Character_Social&&a.push(e.Character_Social),e.Character_Residential&&r.push(e.Character_Residential)});for(var e=[],i=0;i<a.length;i++){var n={social:a[i],sg:"-",residential:r[i],rg:"-"};e.push(n)}x.characterMatrix=e,x.promoted="PROMOTED"},function(t){alert(t.statusText)})},x.getTotals=function(){x.exam1Tot=0,x.exam2Tot=0,x.exam3Tot=0,x.exam4Tot=0,x.exam5Tot=0,x.exam6Tot=0,x.exam1Per=0,x.exam2Per=0,x.exam3Per=0,x.exam4Per=0,x.exam5Per=0,x.exam6Per=0,x.Tot1=0,x.Tot2=0,x.Tot3=0,x.finalAvg=0,x.perTot1=0,x.perTot2=0,x.perTot3=0;var t=x.perFinalAvg=0;for(t=0;t<x.studentMatrix.length;t++){var e=x.studentMatrix[t];x.exam1Tot+=isNaN(e.exam1)?0:Number(e.exam1),x.exam2Tot+=isNaN(e.exam2)?0:Number(e.exam2),x.exam3Tot+=isNaN(e.exam3)?0:Number(e.exam3),x.exam4Tot+=isNaN(e.exam4)?0:Number(e.exam4),x.exam5Tot+=isNaN(e.exam5)?0:Number(e.exam5),x.exam6Tot+=isNaN(e.exam6)?0:Number(e.exam6),isNaN(e.exam1)||isNaN(e.exam2)||isNaN(e.exam3)||(x.Tot1+=Number(e.exam1)+Number(e.exam2)+Number(e.exam3)),isNaN(e.exam4)||isNaN(e.exam5)||isNaN(e.exam6)||(x.Tot2+=Number(e.exam4)+Number(e.exam5)+Number(e.exam6)),x.Tot3=x.Tot1+x.Tot2,x.finalAvg=Math.round(x.Tot3/2)}Number($("#hidGrade").val())<=6&&(x.exam1Per=(100*x.exam1Tot/120).toFixed(1),x.exam2Per=(100*x.exam2Tot/120).toFixed(1),x.exam3Per=(100*x.exam3Tot/360).toFixed(1),x.exam4Per=(100*x.exam4Tot/120).toFixed(1),x.exam5Per=(100*x.exam5Tot/120).toFixed(1),x.exam6Per=(100*x.exam6Tot/360).toFixed(1),x.perTot1=(100*x.Tot1/600).toFixed(1),x.perTot2=(100*x.Tot2/600).toFixed(1),x.perTot3=(100*x.Tot3/1200).toFixed(1),x.perFinalAvg=(100*x.finalAvg/600).toFixed(1)),6<Number($("#hidGrade").val())&&(x.exam1Per=(100*x.exam1Tot/200).toFixed(1),x.exam2Per=(100*x.exam2Tot/200).toFixed(1),x.exam3Per=(100*x.exam3Tot/600).toFixed(1),x.exam4Per=(100*x.exam4Tot/200).toFixed(1),x.exam5Per=(100*x.exam5Tot/200).toFixed(1),x.exam6Per=(100*x.exam6Tot/600).toFixed(1),x.perTot1=(100*x.Tot1/1e3).toFixed(1),x.perTot2=(100*x.Tot2/1e3).toFixed(1),x.perTot3=(100*x.Tot3/2e3).toFixed(1),x.perFinalAvg=(100*x.finalAvg/1e3).toFixed(1))},x.getActiveClass=function(t){return"True"==t?"fa fa-circle-o activeUser":"fa fa-circle-o inactiveUser"},x.changeListActive=function(){var a=!1;$.each(x.StudentFullList,function(t,e){-1<e.studentName.indexOf("False")&&(a=!0)}),x.wait=!0,a?(n=[],$("#chkActive").is(":checked")?($.each(x.StudentList,function(t,e){-1==e.studentName.indexOf("False")&&n.push(e)}),x.StudentList=n):(x.StudentList=x.StudentFullList,n=x.StudentFullList),x.wait=!1):r.get("/Students/getStudentList?activeOnly="+$("#chkActive").is(":checked")).then(function(t){n=[],x.StudentFullList=t.data,x.StudentList=x.StudentFullList,n=x.StudentFullList,x.wait=!1},function(t){alert(t.statusText),x.wait=!1})},x.updateMatrix=function(){for(x.wait=!0,i=0;i<x.studentMatrix.length;i++)"Attendance"==x.studentMatrix[i].type&&(x.studentMatrix[i].exam1=x.attendanceArray[0],x.studentMatrix[i].exam2=x.attendanceArray[1],x.studentMatrix[i].exam3=x.attendanceArray[2],x.studentMatrix[i].exam4=x.attendanceArray[3],x.studentMatrix[i].exam5=x.attendanceArray[4],x.studentMatrix[i].exam6=x.attendanceArray[5]),"Text"==x.studentMatrix[i].type&&"Remarks"==x.studentMatrix[i].subject&&(x.studentMatrix[i].exam1=x.remarksArray[0],x.studentMatrix[i].exam2=x.remarksArray[1],x.studentMatrix[i].exam3=x.remarksArray[2],x.studentMatrix[i].exam4=x.remarksArray[3],x.studentMatrix[i].exam5=x.remarksArray[4],x.studentMatrix[i].exam6=x.remarksArray[5]);var t=x.studentMatrix;r.post("/Students/saveMatrix",t).then(function(t){x.wait=!1,alert("Marks details were updated.")},function(t){alert(t.statusText),x.wait=!1})},x.getGrade=function(t){return-1<t.indexOf("-")?"-":-1<t.indexOf("E")?"E":-1<t.indexOf("D")?"D":-1<t.indexOf("C")?"C":-1<t.indexOf("B")?"B":-1<t.indexOf("A")?"A":void 0},x.printMatrix=function(){for(x.wait=!0,i=0;i<x.studentMatrix.length;i++)"Attendance"==x.studentMatrix[i].type&&(x.studentMatrix[i].exam1=x.attendanceArray[0],x.studentMatrix[i].exam2=x.attendanceArray[1],x.studentMatrix[i].exam3=x.attendanceArray[2],x.studentMatrix[i].exam4=x.attendanceArray[3],x.studentMatrix[i].exam5=x.attendanceArray[4],x.studentMatrix[i].exam6=x.attendanceArray[5]),"Text"==x.studentMatrix[i].type&&"Remarks"==x.studentMatrix[i].subject&&(x.studentMatrix[i].exam1=x.remarksArray[0],x.studentMatrix[i].exam2=x.remarksArray[1],x.studentMatrix[i].exam3=x.remarksArray[2],x.studentMatrix[i].exam4=x.remarksArray[3],x.studentMatrix[i].exam5=x.remarksArray[4],x.studentMatrix[i].exam6=x.remarksArray[5]);var t={matrix:x.studentMatrix,exam1Tot:x.exam1Tot,exam2Tot:x.exam2Tot,exam3Tot:x.exam3Tot,exam4Tot:x.exam4Tot,exam5Tot:x.exam5Tot,exam6Tot:x.exam6Tot,exam1Per:x.exam1Per,exam2Per:x.exam2Per,exam3Per:x.exam3Per,exam4Per:x.exam4Per,exam5Per:x.exam5Per,exam6Per:x.exam6Per,Tot1:x.Tot1,Tot2:x.Tot2,Tot3:x.Tot3,perTot1:x.perTot1,perTot2:x.perTot2,perTot3:x.perTot3,finalAvg:x.finalAvg,perFinalAvg:x.perFinalAvg};r.post("/Students/printMatrix",t).then(function(t){x.wait=!1,t.data.res?window.open(window.location.href.split("/")[0]+"/"+t.data.file,"_blank"):alert(t.data.status+" "+t.data.errors)},function(t){alert(t.statusText),x.wait=!1})},x.printCharacterCert=function(){console.log(x.characterMatrix);var t={promoted:x.promoted,notready:x.notready,characterMatrix:x.characterMatrix};r.post("/Students/printCharacterCert",t).then(function(t){x.wait=!1,t.data.res?window.open(window.location.href.split("/")[0]+"/"+t.data.file,"_blank"):alert(t.data.status+" "+t.data.errors)},function(t){alert(t.statusText),x.wait=!1})}}]);